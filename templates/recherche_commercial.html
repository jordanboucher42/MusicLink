{% extends 'base.html' %}

{% block content %}
<h1>{% block title %} Recherche d'artiste commercial {% endblock %}</h1>

<form action="{{url_for('.resultat_commercial')}}" method="get" class="row">
    <label for="search-comm" class="col-1 col-form-label">Nom :</label>
    <div class="col-3">
        <input type="text" class="form-control col-3" id="search-comm" name="nom" required>
    </div>
    <div class="col-3">
        <button type="submit" class="btn btn-primary">
            Rechercher
        </button>
    </div>
</form>
<div class="row my-5 row-cols-1 row-cols-md-3 g-4">
    {% for artistData in artistsData %}
    <div class="col">
        <div class="card h-100">
            {% if not artistData['images'] %}
            <p class="text-center text-danger">
                No image available
            </p>
            {% else %}
            <img src="{{artistData['images'][0]['url']}}" class="card-img-top" alt="Image de l'artiste">
            {% endif %}
            <div class="card-body">
                <h5 class="card-title">{{artistData['artistName']}}</h5>
                {% if not artistData['genres'] %}
                <span class="badge rounded-pill bg-danger my-4">Pas de genres défini</span>
                {% else %}
                {% for style in artistData['genres'] %}
                <span class="badge rounded-pill bg-secondary">{{style}}</span>
                {% endfor %}
                {% endif %}

                {% if not artistData['overview'] %}
                <span class="badge rounded-pill bg-danger my-4">Pas d'histoire défini</span>
                {% else %}
                <p id="overview-{{loop.index}}" class="line-clamp mt-5">{{artistData['overview']}}</p>
                <div class="w-100 text-end">
                    <button id="full-history-{{loop.index}}" class="btn btn-link" onclick="getHistory({{loop.index}})">
                        en savoir plus
                    </button>
                </div>
                {% endif %}
            </div>
            <div class="card-footer bg-transparent border-dark">
                {% if not artistData['path'] %}
                <form action="/confirmed/commercial" method="post">
                    <input type="hidden" id="artistName" name="artistName" value={{artistData['artistName']}}>
                    <button type="submit" class="btn btn-primary">Ajouter l'artiste</button>
                </form>
                {% else %}
                <div class="text-center">
                    <span class="badge rounded-pill bg-success">{{artistData['artistName']}} fait déjà partie de la bibliothèque Plex</span>
                </div>
                {% endif %}
            </div>

        </div>
    </div>
    {% endfor %}
</div>

<!--TODO create service -->
<script>
function getHistory(index) {
    var classList = $(`#overview-${index}`).attr("class").split(/\s+/);
    console.log(classList);
    console.log($.inArray("line-clamp", classList));
    if($.inArray("line-clamp", classList) != -1) {
        $(`#overview-${index}`).removeClass('line-clamp');
        $(`#full-history-${index}`).html("afficher moins");
    } else {
        $(`#overview-${index}`).addClass('line-clamp');
        $(`#full-history-${index}`).html("en savoir plus");
    }
}

</script>
{% endblock %}